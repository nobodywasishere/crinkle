{
  "type": "Template",
  "body": [
    {
      "type": "Text",
      "value": "<div>\n  <script nonce=\""
    },
    {
      "type": "Output",
      "expr": {
        "type": "Name",
        "value": "foo"
      }
    },
    {
      "type": "Text",
      "value": "\">\n            let ready = false;\n            let submitted = false;\n\n            const form = document.querySelector(\"#form\");\n            const button = form.querySelector(\"#submit\");\n            const errorNotice = document.querySelector(\"#error\");\n\n            form.addEventListener(\"submit\", (e) => {\n              if (ready) return;\n\n              submitted = true;\n\n              button.disabled = true;\n              button.classList.toggle(\"--disabled\");\n              button.title = \"Please wait while we verify\";\n\n              e.preventDefault();\n            });\n\n            async function onError(code) {\n              console.error(`Validation failed: ${code}`)\n              errorNotice.hidden = false;\n              // NOTE(team): We could inspect the specific error family and show a specific message.\n              // But in most cases, refreshing the page is all they can do if we get here.\n            }\n\n            async function onSuccess(token) {\n              const response = await fetch(\"/verify\", {\n                method: \"POST\",\n                headers: {\n                  \"Content-Type\": \"text/plain\",\n                },\n                body: token,\n                credentials: \"same-origin\",\n              });\n              const ok = await response.json();\n              ready = true;\n\n              if (submitted) {\n                button.disabled = false;\n                button.classList.toggle(\"--disabled\");\n                button.title = \"\";\n              }\n\n              if (ok) {\n                console.log(\"Verify complete!\");\n\n                if (submitted) {\n                  form.submit();\n                }\n              } else {\n  "
    },
    {
      "type": "Comment",
      "text": "\n    TODO(team): The check passed, but verification failed.\n    Communicate this to the user somehow.\n\n    TODO(team): Hmm, what do we do here? Let it fail, have them try\n    again on the \"full\" page...?\n  "
    },
    {
      "type": "Text",
      "value": "\n                alert(\"Verification failed. If this persists, please reach out to support@example.com with details.\");\n                window.location = \"/#verification-error\";\n              }\n\n              submitted = false;\n            }\n  </script>\n</div>\n"
    }
  ]
}